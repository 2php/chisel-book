\documentclass[xcolor=pdflatex,dvipsnames,table]{beamer}
\usepackage{epsfig,graphicx}
\usepackage{palatino}
\usepackage{fancybox}
\usepackage{relsize}
\usepackage[procnames]{listings}
\usepackage{hyperref}
\usepackage{qtree}


% fatter TT font
\renewcommand*\ttdefault{txtt}
% another TT, suggested by Alex
% \usepackage{inconsolata}
% \usepackage[T1]{fontenc} % needed as well?

\usepackage[procnames]{listings}

\newcommand{\scale}{0.7}

\newif\ifbook
\input{../shared/chisel.tex}

\hypersetup{
  linkcolor  = black,
%  citecolor  = blue,
  urlcolor   = blue,
  colorlinks = true,
}

\newcommand{\code}[1]{{\texttt{#1}}}

\beamertemplatenavigationsymbolsempty
\setbeamertemplate{footline}[frame number]

\newcommand{\todo}[1]{{\emph{TODO: #1}}}
\newcommand{\martin}[1]{{\color{blue} Martin: #1}}
\newcommand{\abcdef}[1]{{\color{red} Author2: #1}}

% uncomment following for final submission
%\renewcommand{\todo}[1]{}
%\renewcommand{\martin}[1]{}
%\renewcommand{\author2}[1]{}


\title{Digital Electronics 2: Introduction}
\author{Martin Schoeberl}
\date{\today}
\institute{Technical University of Denmark\\
Embedded Systems Engineering}

\begin{document}

\begin{frame}
\titlepage
\end{frame}


\begin{frame}[fragile]{Overview}
\begin{itemize}
\item Motivation and the digital abstraction
\item Course organization
\item Languages for hardware design
\item Testing (see 2.1.4)
\item A first round in Chisel
\item Tools and setup
\end{itemize}
\end{frame}


\begin{frame}[fragile]{A BIG Chip}
\begin{itemize}
\item \url{https://singularityhub.com/2019/08/26/this-giant-ai-chip-is-the-size-of-an-ipad-and-holds-1-2-trillion-transistors/}
\item $1.2 \times 10^{12}$ transistors
\item If you design 1 gate (= 4 transistors) per second
\begin{itemize}
\item It takes you 10 thousand years!
\end{itemize}
\item This calls for some abstraction
\end{itemize}
\end{frame}

\begin{frame}[fragile]{Digital Systems are Everywhere}
\begin{itemize}
\item Digital systems are all over in our live
\item No more analog media
\item CD, mobile phone, TV, DVD,... all digital now
\item Analog circuits only at the edge
\item The rest is processed in digital
\item If performance allows, functions are moved to software
\item But processor speedup has slowed down
\item Algorithms are moved back into hardware
\end{itemize}
\end{frame}

\begin{frame}[fragile]{FPGAs in the Cloud}
\begin{itemize}
\item High performance algorithm in an FPGA
\item \href{https://aws.amazon.com/ec2/instance-types/f1/}{An FPGA in the cloud}
\item \href{https://www.intel.com/content/www/us/en/products/docs/storage/programmable/applications/cloud.html}{Intel offers FPGAs for servers}
\begin{itemize}
\item There is some reason why Intel bought Altera
\end{itemize}
\item We need digital designers to make this work
\item A good time to be a digital designer
\end{itemize}
\end{frame}

\begin{frame}[fragile]{The Digital Abstraction}
\begin{columns}
 
\column{0.5\textwidth}
\begin{itemize}
\item Just two values: 0 and 1, or low and hight
\item Represented as voltage
\item Digital signals tolerate noise
\item Digital Systems are \emph{simple}, just:
\begin{itemize}
\item Combinational circuits and
\item Registers
\end{itemize}
\end{itemize}
 
\column{0.5\textwidth}
\begin{figure}
  \includegraphics[scale=\scale]{../figures/logic}
\end{figure}
\begin{figure}
  \includegraphics[scale=\scale]{../figures/register}
\end{figure}
\end{columns}

\end{frame}

\begin{frame}[fragile]{Hardware Design in DK}
\begin{itemize}
\item Oticon
\item Widex
\item Microsemi
\item probably some more...
\item 
\item They are all hiring
\end{itemize}
\end{frame}

\begin{frame}[fragile]{Digital Design within an EE Master}
\begin{itemize}
\item Not an obvious choice, as there is no specialization in digital systems
\item Select some of the following courses
\begin{itemize}
\item 02155: Computer Architecture and Engineering
\item 02203: Design of Digital Systems
\item 02211: Advanced Computer Architecture
\item 02205: VLSI Design
\item 02217: Design of Arithmetic Processors
\item 02204: Design of Asynchronous Circuits
\end{itemize}
\end{itemize}
\end{frame}

\begin{frame}[fragile]{Computer Engineering Education at DTU}
\begin{itemize}
\item On the border between hardware and software
\item Very well payed jobs :-)
\item Not an easy choice at DTU as well
\begin{itemize}
\item No BSc available
\item Between EE and CS
\end{itemize}
\item Start with Bsc. in EE
\item Specialization in Indlejrede systemer og programmering
\begin{itemize}
\item 02155: Computer Architecture and Engineering
\item 02105: Algoritmer og datastrukturer
\end{itemize}
\item Continue as MSc. in Computer Science and Engineering
\item Specialization in
\begin{itemize}
\item Digital Systems
\item Embedded and Distributed Systems
\end{itemize}
\end{itemize}
\end{frame}

\begin{frame}[fragile]{Web Resources}
\begin{itemize}
\item \href{https://cn.inside.dtu.dk/cnnet/element/612883/frontpage}{DTU Inside}
\begin{itemize}
\item Vending machine document
\item Project report hand in
\end{itemize}
\item \href{http://www2.imm.dtu.dk/courses/02139/}{Course website}
\begin{itemize}
\item General information, starting point
\end{itemize}
\item \href{https://github.com/schoeberl/chisel-lab}{Lab website}
\begin{itemize}
\item Lab material on GitHub
\end{itemize}
\item \href{http://www.imm.dtu.dk/~masca/chisel-book.html}{Chisel book website}
\begin{itemize}
\item Download the free PDF
\end{itemize}
\end{itemize}
\end{frame}

\begin{frame}[fragile]{Organization and Workload}
\begin{itemize}
\item Usually 2 hours lectures and 2 hours supervised lab
\item 5 ECTS is equivalent to 9 hours per week
\item That means 5 hours work on your own
\begin{itemize}
\item Do some reading, prepare for the lecture and lab
\item Get the tools installed on your laptop
\item You have an FPGA board, experiment with it
\end{itemize}
\item You will learn a lot in this course, it will make you a better:
\begin{itemize}
\item engineer
\item hardware designer
\item programmer, and
\item computer user in general
\end{itemize}
\item Try to have fun with building stuff that is real!
\end{itemize}
\end{frame}

\begin{frame}[fragile]{Communication and Getting Help}
\begin{itemize}
\item Several sources of information:
\begin{itemize}
\item The Internet, Google, and Stackoverflow
\item Your fellow students (e.g., via Slack)
\item The TAs: \href{https://cn.inside.dtu.dk/cnnet/element/612883/participants}{Simon, Kasper, and Anthon}
\item Me
\end{itemize}
\item We will use Slack for easy communication (if ok for you)
\begin{itemize}
\item \url{https://de2019.slack.com/}
\end{itemize}
\item You can always just knock my door or shoot me an email
\item Anonymous feedback
\end{itemize}
\end{frame}

\begin{frame}[fragile]{Anonymous Feedback}
\begin{itemize}
\item Inbox available at: 
\href{https://docs.google.com/forms/d/e/1FAIpQLSclKyEM_foF7U0TF-CoIZhla5EFEcE8-EGD7Jvle6TBB90WZw/viewform?vc=0&c=0&w=1&usp=mail_form_link}{Anonymous Inbox}
\item Simple Google form without revealing your identity
\item I will get notified by an email
\item Use when you want to complain, give feedback, but also when you like something ;-)
\item Even when frustrated, please be polite, a human is reading this
\end{itemize}
\end{frame}

\begin{frame}[fragile]{Cheating and Plagiarism}
\begin{itemize}
\item It is ok and good practice to discuss problems and solutions with your fellow students
\item But you need to hand in your own solution
\item Copying stuff or offering stuff for copying is cheating
\item Copying material from somewhere is plagiarism and copyright violation
\item Cheating is handled quite rigorous at DTU, you might get expelled
\item Using source code control (GitHub) is good practice
\item However, keep it private. Otherwise you might contribute to cheating
\end{itemize}
\end{frame}


\begin{frame}[fragile]{This is an Open-Access/Open-Source Course}
\begin{itemize}
\item Almost all material is public visible
\item Slides are open access
\item Lab material is open access
\item Hosted on GitHub
\begin{itemize}
\item \textbf{You} can contribute with a pull request
\item Becoming an author of this course :-)
\end{itemize}
\item The Chisel book is freely available
\end{itemize}
\end{frame}

\begin{frame}[fragile]{Lab Work}
\begin{itemize}
\item Some paper and pencil exercises
\item Most work on computer designing digital circuits
\item abc
\item abc
\item abc
\begin{itemize}
\item xxx
\end{itemize}
\item abc
\end{itemize}
\end{frame}

\begin{frame}[fragile]{A Vending Machine from 1952}
\begin{figure}
    \centering
    \href{https://en.wikipedia.org/wiki/File:CandiesVendingMachine1952.jpg}{\includegraphics[scale=0.4]{CandiesVendingMachine1952}}

\end{figure}

{\tiny Source: Minnesota Historical Society, \href{https://creativecommons.org/licenses/by-sa/2.0}{CC BY-SA 2.0}}
\end{frame}

\begin{frame}[fragile]{The Vending Machine}
\begin{itemize}
\item Final project is a vending machine
\item abc
\item abc
\item abc
\item VM in hardware versus VM in software
\begin{itemize}
\item This is an exercise that you can solve with reasonable effort
\end{itemize}
\item abc
\end{itemize}
\end{frame}


\begin{frame}[fragile]{Motivating Example for Chisel:\\
Lipsi: Probably the Smallest Processor in the World}
\begin{itemize}
\item Tiny processor
\item Simple instruction set
\item Shall be small
\begin{itemize}
\item Around 200 logic cells, one FPGA memory block
\end{itemize}
\item Hardware described in Chisel
\item Available at \url{https://github.com/schoeberl/lipsi}
\item Usage
\begin{itemize}
\item Utility processor for small stuff
\item Could be used for your vending machine
\item In teaching for introduction to computer architecture
\end{itemize}
\item The design took place on the island Lipsi
\end{itemize}
\end{frame}

\begin{frame}[fragile]{The Design of Lipsi on Lipsi}
\begin{figure}
    \centering
    \includegraphics[scale=0.3]{../slides-tutorial/lipsi}
\end{figure}
\end{frame}

\begin{frame}[fragile]{Lipsi Implementation}
\begin{itemize}
\item Hardware described in Chisel
\item Tester in Chisel
\item Assembler in Scala
\begin{itemize}
\item Core case statement about 20 lines
\end{itemize}
\item Reference design of Lipsi as software simulator in Scala
\item Testing:
\begin{itemize}
\item Self testing assembler programs
\item Comparing hardware with a software simulator
\end{itemize}
\item All in a single programming language!
\item All in a single program
\item How much work is this?
\end{itemize}
\end{frame}

\begin{frame}[fragile]{Chisel is Productive}
\begin{itemize}
\item All coded and tested in less than 14 hours!
\end{itemize}
\begin{itemize}
\item The hardware in Chisel
\item Assembler in Scala
\item Some assembler programs (blinking LED)
\item Simulation in Scala
\item Two testers
\end{itemize}
\begin{itemize}
\item BUT, this does not include the design (done on paper)
\end{itemize}
\end{frame}

\begin{frame}[fragile]{Motivating Example: Lipsi, a Tiny Processor}
\begin{itemize}
\item Show in IntelliJ (if beamer allows)
\end{itemize}
\end{frame}

\begin{frame}[fragile]{The Slides are Online}
\begin{itemize}
\item \url{http://www2.imm.dtu.dk/courses/02139/}
\item \url{https://github.com/schoeberl/chisel-book/tree/master/slides}
\end{itemize}
%\begin{figure}
%    \centering
%    \includegraphics[scale=0.5]{slides-link}
%\end{figure}
\end{frame}

\begin{frame}[fragile]{Why Chisel Instead of VHDL/Verilog/SystemVerilog?}
\begin{itemize}
\item Company O does VHDL, company W does Verilog
\begin{itemize}
\item Why Chisel?
\end{itemize}
\item We learn principles of digital design, not tools
\begin{itemize}
\item We pick a language that is modern and productive
\end{itemize}
\item When knowing principles, switching the language is a matter of a week
\item You are the future engineers and shall learn new tools
\item You may then bring Chisel into the company
\end{itemize}
\end{frame}

\begin{frame}[fragile]{More on Chisel Success Stories}
\begin{itemize}
\item Last week at CCC 2020 (in silicon valley)
\item 90 participants
\item More than 30 different (hardware) companies present
\item Several companies are looking into Chisel
\item IBM did an open-source PowerPC
\item \href{https://www.sifive.com/}{SiFive} is a RISC-V startup success
\begin{itemize}
\item High productivity with Chisel
\item Open-source Rocket chip
\end{itemize}
\item Experanto uses the BOOM processor in Chisel
\item Google did a machine learning processor
\item Intel is looking at Chisel
\item Chisel is open-source, if there is a bug you can fix it
\begin{itemize}
\item You can contribute to the Chisel ecosystem
\end{itemize}
\end{itemize}
\end{frame}

\begin{frame}[fragile]{More Notes}
\begin{itemize}
\item Tell silicon valley story
\item Show tools
\item show success stories
\begin{itemize}
\item Cut most Chisel out from this slides, it is too much for the first intro in DE2
\item keep it for the faster intro
\end{itemize}
\item abc
\end{itemize}
\end{frame}

\begin{frame}[fragile]{Introduction to Chisel}
\begin{itemize}
\item Get an idea what Chisel is
\begin{itemize}
\item Will show you code snippets
\end{itemize}
\item A first high level view of the main features of Chisel
\item Reconsider how to describe hardware
\item Some experience report from usage at DTU
\item Pointers to more information
\item Have your first Chisel design running in an FPGA!
\end{itemize}
\end{frame}

%\begin{frame}[fragile]{Talk abstract}
%
%Date: Tu 19/04/2016, 11:00-12:00
%Room: 123/322
%
%Title: Hardware Design in the 21st Century: with the Object Oriented
%and Functional Language Chisel
%
%Chisel is a hardware construction language implemented as a
%domain specific language in Scala. Therefore, the full power of
%a modern programming language is available to describe hardware
%and, more important, hardware generators. Chisel has been developed
%at UC Berkeley and successfully used for several tape outs of RISC-V.
%Here at DTU we used Chisel in the T-CREST project and in teaching
%advanced computer architecture. Besides presenting small code
%examples in Chisel I will report on experiences on using Chisel in
%the t-CREST project and in teaching.
%
%Martin Schoeberl
%\end{frame}

\begin{frame}[fragile]{Chisel}
\begin{itemize}
\item A hardware \emph{construction} language
\begin{itemize}
\item Constructing Hardware In a Scala Embedded Language
\item If it compiles, it is synthesisable hardware 
\item Say goodby to your unintended latches
\end{itemize}
\item Chisel is not a high-level synthesis language
\item Single source two targets
\begin{itemize}
\item Cycle accurate simulation (testing)
\item Verilog for synthesis
\end{itemize}
\item Embedded in Scala
\begin{itemize}
\item Full power of Scala available
\item But to start with, no Scala knowledge needed
\end{itemize}
\item Developed at UC Berkeley
\end{itemize}
\end{frame}

\begin{frame}[fragile]{The C Language Familie}

\Tree[.C [
   [.{\bf Verilog} {\bf SystemVerilog} ]
   [.C++  \emph{SystemC}  ]
   [.Java [.Scala {\bf Chisel} ] ]
   [.C\# ] ] ]
 
\end{frame}

\begin{frame}[fragile]{Other Language Families}

\begin{columns}
\column{0.5\textwidth}
\begin{center}
\Tree[.Algol [.Ada [.{\bf VHDL} ] ] ]
\end{center}
\column{0.5\textwidth}
\begin{center}
\Tree[.Python [.{\bf MyHDL} ] ]
\end{center}
\end{columns}
\end{frame}

\begin{frame}[fragile]{Some Notes on Scala}
\begin{itemize}
\item Object oriented
\item Functional
\item Strongly typed
\begin{itemize}
\item With very good type inference
\end{itemize}
\item Could be seen as Java++
\item Compiled to the JVM
\item Good Java interoperability
\begin{itemize}
\item Many libraries available
\item You can write your testing code in Java
\end{itemize}
\end{itemize}
\end{frame}

\begin{frame}[fragile]{Chisel vs. Scala}
\begin{itemize}
\item A Chisel hardware description is a Scala program
\item Chisel is a Scala library
\item When the program is executed it generates hardware
\item Chisel is a so-called \emph{embedded domain-specific language}
\end{itemize}
\end{frame}


\begin{frame}[fragile]{Expressions are Combinational Circuits}
\begin{chisel}
(a | b) & ~(c ^ d)

val addVal = a + b
val orVal = a | b
val boolVal = a >= b
\end{chisel}
\begin{itemize}
\item The usual operations 
\item Simple name assignment with val
\item Width inference
\item Type inference
\item Types: Bits, UInt, SInt, Bool
\end{itemize}
\end{frame}

\begin{frame}[fragile]{Registers}
\begin{chisel}
val cntReg = RegInit(0.U(32.W))

cntReg := cntReg + 1.U
\end{chisel}
\begin{itemize}
\item Type inferred by initial value (= reset value)
\item No need to specify a clock or reset signal
\end{itemize}
\begin{itemize}
\item Also definition with an input signal connected:
\end{itemize}
\begin{chisel}
val r = RegNext(nextVal) 
\end{chisel}
\end{frame}

\begin{frame}[fragile]{Functional Abstraction}
\begin{chisel}
  def addSub(add: Bool, a: UInt, b: UInt) =
    Mux(add, a+b, a-b)

  val res = addSub(cond, a, b)
  
  def rising(d: Bool) = d && !RegNext(d)
\end{chisel}
\begin{itemize}
\item Functions for repeated pieces of logic
\item May contain state
\item Functions may return \emph{hardware}
\end{itemize}
\end{frame}


\begin{frame}[fragile]{Bundles}
\begin{chisel}
class DecodeExecute extends Bundle {
  val rs1 = UInt(32.W)
  val rs2 = UInt(32.W)
  val immVal = UInt(32.W)
  val aluOp = new AluOp()
}
\end{chisel}
\begin{itemize}
\item Collection of values in named fields 
\item Like struct or record
\end{itemize}
\end{frame}

\begin{frame}[fragile]{Vectors}
\begin{chisel}
val myVec = Vec(3, SInt(10.W))

myVec(0) := -3.S
val y = myVec(2)
\end{chisel}
\begin{itemize}
\item Indexable vector of elements
\item Bundles and Vecs can be arbitrarely nested
\end{itemize}
\end{frame}

\begin{frame}[fragile]{IO Ports}
\begin{chisel}
class Channel extends Bundle {
  val data = Input(UInt(8.W))
  val ready = Output(Bool())
  val valid = Input(Bool())
}
\end{chisel}
\begin{itemize}
\item Ports are Bundles with directions
\item Direction can also be assigned at instantiation:
\end{itemize}
\begin{chisel}
class ExecuteIO extends Bundle {
  val dec = Input(new DecodeExecute())
  val mem = Output(new ExecuteMemory())
}
\end{chisel}
\end{frame}

\begin{frame}[fragile]{Modules}
\begin{chisel}
class Adder extends Module {
  val io = IO(new Bundle {
    val a = Input(UInt(4.W))
    val b = Input(UInt(4.W))
    val result = Output(UInt(4.W))
  })

  val addVal = io.a + io.b
  io.result := addVal
}
\end{chisel}
\begin{itemize}
\item Organization of components
\item IO ports defined as a Bundle named \code{io} and wrapped into an \code{IO()}
\item Created (instantiated) with:
\end{itemize}
\begin{chisel}
val adder = Module(new Adder())
\end{chisel}
\end{frame}

\begin{frame}[fragile]{Hello World in Chisel}
\shortlist{../code/hello.txt}
\end{frame}

\begin{frame}[fragile]{Connections}
\begin{itemize}
\item Simple connections just with assignments, e.g.,
\begin{chisel}
  adder.io.a := ina
  adder.io.b := inb
\end{chisel}
\item Automatic bulk connections between components
\begin{chisel}
  dec.io <> exe.io
  mem.io <> exe.io
\end{chisel}
\end{itemize}
\end{frame}

\begin{frame}[fragile]{Generic Components}
\begin{chisel}
val c = Mux(cond, a, b)
\end{chisel}
\begin{itemize}
\item This is a multiplexer
\item Input can be any type
\end{itemize}
\end{frame}

\begin{frame}[fragile]{Testing}
\begin{chisel}
class CounterTester(c: Counter) extends PeekPokeTester(c) {
  for (i <- 0 until 5) {
    println(i.toString + ": " + peek(c.io.out).toString())
    step(1)
  }
}
\end{chisel}
\begin{itemize}
\item Within Chisel with a tester (= Scala program)
\item May include waveform generation
\item peek and poke to read and set values
\begin{itemize}
\item Remember the BASIC days ;-)
\end{itemize}
\item printf in simulation on rising edge
\begin{chisel}
printf("Counting %x\n", r1)
\end{chisel}
\end{itemize}
\end{frame}

\begin{frame}[fragile]{Component Generation}
\begin{chisel}
val cores = new Array[Module](32)

for (j <- 0 until 32)
  cores(j) = Module(new CPU())
\end{chisel}
\begin{itemize}
\item Use Scala array to collect components
\item Generation with a Scala loop
\end{itemize}
\end{frame}

\begin{frame}[fragile]{Conditional Component Generation}
\begin{chisel}
val icache =
  if (TYPE == METHOD)
    Module(new MCache())
  else if (TYPE == LINE)
    Module(new ICache())
  else
    ChiselError.error("Unsupported Type")
\end{chisel}
\begin{itemize}
\item Use Scala if/else for conditional component types
\item Code example from Patmos
\item We parse an XML file for the configuration
\end{itemize}
\end{frame}

\begin{frame}[fragile]{Logic Generation}
\begin{itemize}
\item Read a file into a table
\begin{itemize}
\item E.g., to read in ROM content for a processor
\end{itemize}
\item Generate a truth table algorithmically
\begin{itemize}
\item E.g., generate binary to BCD translation
\end{itemize}
\item Use the full power of Scala
\end{itemize}
\begin{chisel}
val byteArray = Files.readAllBytes(Paths.get(fileName))
val arr = new Array[Bits](byteArray.length)
for (i <- 0 until byteArray.length) {
  arr(i) = Bits(byteArray(i), 8)
}
val rom = Vec[Bits](arr)
\end{chisel}
\end{frame}
%%%%%%%%%%%%%%%%%
%\begin{frame}[fragile]{zzz}
%\begin{chisel}
%code
%\end{chisel}
%\begin{itemize}
%\item xxx
%\item xxx
%\item xxx
%\end{itemize}
%\end{frame}
%
%\begin{frame}[fragile]{yyy}
%\begin{itemize}
%\item xxx
%\item xxx
%\item xxx
%\item xxx
%\item xxx
%\end{itemize}
%\end{frame}
%%%%%%%%%%%%%%%%%

\begin{frame}[fragile]{Free Tools for Chisel and FPGA Design}
\begin{itemize}
\item \href{https://adoptopenjdk.net/}{Java OpenJDK 8}
\item \href{https://www.scala-sbt.org/}{sbt, the Scala (and Java) build tool}
\item \href{https://www.jetbrains.com/idea/download/}{IntelliJ (the free Community version)}
\item \href{http://gtkwave.sourceforge.net/}{GTKWave}
\item \href{https://www.xilinx.com/products/design-tools/vivado/vivado-webpack.html}{Vivado WebPACK} or
\item \href{http://www.altera.com/products/software/quartus-ii/web-edition/qts-we-index.html}{Quartus}
\item Nice to have:
\begin{itemize}
\item make, git
\end{itemize}
\end{itemize}
\end{frame}

\begin{frame}[fragile]{Tool Setup for Different OSs}
\begin{itemize}
\item Windows
\begin{itemize}
\item Use the installers from the websites
\end{itemize}
\item macOS
\begin{itemize}
\item \code{brew install sbt}
\item For the rest, use the installer from the websites
\end{itemize}
\item Linux/Ubuntu
\begin{itemize}
\item \code{sudo apt install openjdk-8-jdk git make gtkwave}
\item Install sbt, see \url{https://github.com/schoeberl/chisel-lab/blob/master/Setup.md}
\item IntelliJ as from the website
\end{itemize}
\end{itemize}
\end{frame}

\begin{frame}[fragile]{Virtual Machine Setup for Chisel}
\begin{itemize}
\item Ubuntu based
\item \href{http://patmos.compute.dtu.dk/patmos-dev.zip}{Ubuntu VM with Quartus} uid: patmos, pwd: patmos
\item \href{https://patmos-download.compute.dtu.dk/de2lab.zip}{Ubuntu VM with Vivado} uid: de2lab, pwd: de2lab
\begin{itemize}
\item But this is VERY large (40 GB for the .zip file)
\end{itemize}
\item Use the  \href{https://www.vmware.com/products/workstation-player.html} {VMWare Workstation Player} (free for Linux and Windows)
\end{itemize}
\end{frame}

\begin{frame}[fragile]{An IDE for Chisel}
\begin{itemize}
\item Eclipse or IntelliJ
\item Scala plugin
\item For an Eclipse project: sbt eclipse
\item For IntelliJ: File - New - Project from Existing Sources..., open build.sbt
%\item But you are not compiling with Eclipse\\ and against the Chisel source
\item Show it
\end{itemize}
\end{frame}

\begin{frame}[fragile]{Chisel in the T-CREST Project}
\begin{itemize}
\item Patmos processor rewritten in Chisel
\begin{itemize}
\item As part of learning Chisel
\item 6.4.2013: Chisel: 996 LoC vs VHDL: 3020 LoC
\item But VHDL was very verbose, with records maybe 2000 LoC
\end{itemize}
\item Memory controller, memory arbiters, IO devices in Chisel
\item Several Phd, master, and bachelor projects:
\begin{itemize}
\item Patmos stack cache
\item Method cache for Patmos -- Chisel was relative easy
\item TDM based memory arbiter -- trouble with Chisel
\item RISC stack cache -- no issues with Chisel
\item and more ongoing 
\end{itemize}
\end{itemize}
\end{frame}

\begin{frame}[fragile]{Chisel in Teaching}
\begin{itemize}
\item Using/offering it in Advanced Computer Architecture
\item Spring 2016--2018 all projects have been in Chisel
\begin{itemize}
\item 2019 one student refused to use Chisel :-(
\end{itemize}
\item Several Bachelor and Master projects
\item Students pick it up reasonable fast
\item For software engineering students easier than VHDL
\item Switch Digital Electronics 2 at DTU to Chisel (spring semester 2020)
\item Issue of \emph{writing a program} instead of describing hardware remains
\end{itemize}
\end{frame}


\begin{frame}[fragile]{A Chisel Book}
\begin{figure}
    \centering
    \href{https://github.com/schoeberl/chisel-book}{\includegraphics[scale=0.4]{../cover-small}}
\end{figure}

\begin{itemize}
\item Available in open access (PDF)
\item Amazon can do the printout
\end{itemize}
\end{frame}

\begin{frame}[fragile]{Further Information}
\begin{itemize}
\item \url{https://www.chisel-lang.org/}
\item \url{https://github.com/ucb-bar/chisel-tutorial}
\item \url{https://github.com/ucb-bar/generator-bootcamp}
%\item Chisel 2 documentation at \url{https://github.com/schoeberl/chisel2-doc}
%\begin{itemize}
%\item Chisel 2.2 Tutorial
%\item Getting Started with Chisel
%\end{itemize}
\item \url{http://groups.google.com/group/chisel-users}
\item \url{https://github.com/schoeberl/chisel-book}
\end{itemize}
\end{frame}


\begin{frame}[fragile]{Hello World in Chisel and Examples}
\begin{chisel}
git clone https://github.com/schoeberl/chisel-examples.git
\end{chisel}
\begin{itemize}
\item or download from \url{https://github.com/schoeberl/chisel-examples}
\item This contains a minimal Chisel project with the blinking LED
\item Has ready to use project files for:
\begin{itemize}
\item Altera DE0
\item Altera DE1
\item Altera DE2-115
\item Altera DE10-Nano
\item BeMicro
\end{itemize}
\item Plus a simple ALU for HW test and showing Chisel Tester
\item Plus some more examples to explore
\end{itemize}
\end{frame}

\begin{frame}[fragile]{What is a Minimal Chisel Project?}
\begin{itemize}
\item Scala class (e.g., \code{Hello.scala})
\item Build info in \code{build.sbt} for \code{sbt}:
\end{itemize}
\begin{chisel}
scalaVersion := "2.11.7"

libraryDependencies += "edu.berkeley.cs" %% "chisel3" % "3.1.2"
\end{chisel}
\begin{itemize}
\item Run the process manually (look into the Makefile)
\end{itemize}
\end{frame}

\begin{frame}[fragile]{Additional Files in the Hello World Example}
\begin{itemize}
\item A \code{Makefile}
\item Optional Verilog or VHDL top level file %\code{verilog/hello\_top.v}
%\begin{itemize}
%\item For reset and possible PLLs
%\item Can also be in VHDL
%\end{itemize}
\item Quartus project files \code{quartus/altde2-115/hello.q\{p|s\}f}
\begin{itemize}
\item List of source files, device and pin assignments
\item plain text files, look into hello.qsf
\end{itemize}
\end{itemize}
\end{frame}

\begin{frame}[fragile]{Summary}
\begin{itemize}
\item The world is digital
\item Processors do not get much faster -- we need to design custom hardware
\item We need a modern language for hardware/systems design
\item Chisel builds on the power of object-oriented and functional Scala
\item Chisel is good for hardware generators
% \item You can get started with a hardware design in a special course or 4th semester project
\end{itemize}
\end{frame}


\begin{frame}[fragile]{Lab Time (Basys3)}
\begin{itemize}
\item Get a blinking LED working on the FPGA board
\item Clone or download the repository from:
\begin{itemize}
\item \url{https://github.com/schoeberl/chisel-lab}
\end{itemize}
\item Follow the instructions from the lab page
\begin{itemize}
\item Start IntelliJ and follow the instructions from the lab page
\item \code{sbt run}
\item Create a Vivado project
\item Synthesize with the Play button
\item Configure the FPGA with the Programmer button
\end{itemize}
\item {\bf You have your first Chisel design running in an FPGA!}
\end{itemize}
\end{frame}

\begin{frame}[fragile]{Lab Time (DE2-115)}
\begin{itemize}
\item Get a blinking LED working on the FPGA board
\item Clone or download the repository now
\end{itemize}
\begin{chisel}
git clone \\
   https://github.com/schoeberl/chisel-examples.git
cd chisel-examples/hello-world
make
\end{chisel}
\begin{itemize}
\item Start Quartus
\item Open the project at \code{chisel-examples/hello-world/quartus/altde2-115}
\item Synthesize with the Play button
\item Configure the FPGA with the Programmer button
\item {\bf You have your first Chisel design running in an FPGA!}
\end{itemize}
\end{frame}


\begin{frame}[fragile]{Change the Design}
\begin{itemize}
\item Use IntelliJ, \code{gedit}, or the editor you like most
\item Source is in \code{.../src/main/scala/Hello.scala}
\item Change blinking frequency
\item Rerun the example
\item Optional:
\begin{itemize}
\item Change to an asymmetric blinking, e.g., 200 ms on every second 
\item Setup IntelliJ with a Scala project 
\end{itemize}
\end{itemize}
\end{frame}



\end{document}

\begin{frame}[fragile]{Title}
\begin{itemize}
\item abc
\end{itemize}
\end{frame}
