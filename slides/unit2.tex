\documentclass[xcolor=pdflatex,dvipsnames,table]{beamer}
\usepackage{epsfig,graphicx}
\usepackage{palatino}
\usepackage{fancybox}
\usepackage{relsize}
\usepackage[procnames]{listings}
\usepackage{hyperref}


% fatter TT font
\renewcommand*\ttdefault{txtt}
% another TT, suggested by Alex
% \usepackage{inconsolata}
% \usepackage[T1]{fontenc} % needed as well?

\usepackage[procnames]{listings}

\input{../shared/chisel.tex}

\hypersetup{
  linkcolor  = black,
%  citecolor  = blue,
  urlcolor   = blue,
  colorlinks = true,
}

\newcommand{\code}[1]{{\texttt{#1}}}

\beamertemplatenavigationsymbolsempty
\setbeamertemplate{footline}[frame number]

\newcommand{\todo}[1]{{\emph{TODO: #1}}}
\newcommand{\martin}[1]{{\color{blue} Martin: #1}}
\newcommand{\abcdef}[1]{{\color{red} Author2: #1}}

% uncomment following for final submission
%\renewcommand{\todo}[1]{}
%\renewcommand{\martin}[1]{}
%\renewcommand{\author2}[1]{}


\title{Maybe: Chisel Basic Operations\\Chisel Background and a Little Bit of Scala}
\author{Martin Schoeberl}
\date{\today}
\institute{DTU Compute}

\begin{document}

\begin{frame}
\titlepage
\end{frame}

\begin{frame}[fragile]{Chisel and Scala}
\begin{itemize}
\item Chisel is a library written in Scala
\item Chisel code is Scala code
\item When it is run is \emph{generates} hardware
\begin{itemize}
\item Verilog for synthesize
\item C++ code for simulation
\end{itemize}
\item xxx
\item xxx
\end{itemize}
\end{frame}

\begin{frame}[fragile]{Chisel Data Types}
\begin{itemize}
\item Data types for values on wires or state elements
\item Raw collection of bits is type \code{Bits}
\item Simple types to represent integer numbers
\begin{itemize}
\item Unsigned and signed
\item Subtype of \code{Bits}
\end{itemize}
\item Little strange way to specify constants
\item Automatic bit width inference
\item Boolean values are of type \code{Bool}, a single bit value
\end{itemize}
\begin{chisel}
UInt(1)
UInt("habcd")
UInt("b0101")
SInt(-5)
Bool(true)
\end{chisel}
\end{frame}

\begin{frame}[fragile]{Chisel Data Types}
\begin{itemize}
\item Bit width can be explicitly specified
\begin{itemize}
\item \code{SInt} will be sign extended
\item \code{UInt} will be zero extended
\end{itemize}
\end{itemize}
\begin{chisel}
UInt(0, 32)
UInt("habcd", 24)
SInt(-5, 16)
Bool(true)
\end{chisel}
\begin{itemize}
\item \emph{Bundles} for a named collection of values
\item \emph{Vecs} for indexable collection of values
\item Chisel data types are different from Scala builtin types (e.g., Scala's \code{Int})
\end{itemize}
\end{frame}

\begin{frame}[fragile]{Bitwise Logical Operations}
\begin{itemize}
\item Bitwise NOT, AND, OR, and XOR
\item Automatic size extension to larger operand
\end{itemize}
\begin{chisel}
val notVal = ~x
val maskOut = x & UInt("b00001111")
val orVal = x | y
val xorVal = x ^ y
\end{chisel}
\begin{itemize}
\item Bit reduction
\item Results in a \code{Bool}
\end{itemize}
\begin{chisel}
andR(x)
orR(x)
xorR(x)
\end{chisel}
\end{frame}

\begin{frame}[fragile]{Arithmetic Operations}
\begin{itemize}
\item Addition, subtraction, multiplication, division, modulos
\item Automatic size extension to larger operand
\end{itemize}
\begin{chisel}
+, -, *, /, %
\end{chisel}
\begin{itemize}
\item Left and right shifts
\item Left shift extend bit width
\item Right shift reduces bit width
\end{itemize}
\begin{chisel}
<<, >>
\end{chisel}
\end{frame}

\begin{frame}[fragile]{Bitfield Manipulations}
\begin{itemize}
\item Extract a single bit
\end{itemize}
\begin{chisel}
val sign = x(31)
\end{chisel}
\begin{itemize}
\item Extract a sub field from end to start position
\end{itemize}
\begin{chisel}
val lowByte = word(7, 0)
\end{chisel}
\begin{itemize}
\item Concatenate bit fields
\end{itemize}
\begin{chisel}
val word = Cat(highByte, lowByte)
\end{chisel}
\end{frame}

\begin{frame}[fragile]{Comparison}
\begin{itemize}
\item The usual operations
\begin{itemize}
\item Unusual equal and unequal operator symbols
\end{itemize}
\item Operands are \code{UInt} and \code{SInt}
\item Can be \code{Bool} for equal and unequal
\item Result is \code{Bool}
\end{itemize}
\begin{chisel}
===, =/=
>, >=, <, <=
\end{chisel}
\end{frame}

\begin{frame}[fragile]{Boolean Logical Operations}
\begin{itemize}
\item Operands and result are \code{Bool}
\item Logical NOT, AND, and OR
\end{itemize}
\begin{chisel}
val notX = !x
val bothTrue = a && b
val orVal = x || y
\end{chisel}
\end{frame}

\begin{frame}[fragile]{Combinational Circuits}
\begin{itemize}
\item Circuit is a graph of nodes
\item A node is a hardware operator with zero or more inputs
\item Textual expression to wire up nodes
\item Named wires with some (unspecified) width
\end{itemize}
\begin{chisel}
(a | b) & ~c
\end{chisel}
\end{frame}

\begin{frame}[fragile]{Combinational Circuits}
\begin{itemize}
\item Simple expressions represent a circuit tree
\item Arbitrary directed acyclic graphs need named subexpressions
\item Using Scala's \code{val} keyword for variables that don't change
\item Referenced multiple times
\end{itemize}
\begin{chisel}
val cond = a & b
val result = (cond & selA) | (!cond & selB)
\end{chisel}
\end{frame}

\begin{frame}[fragile]{Next Topics -- Some Order}
\begin{itemize}
\item Registers
\item Some more code examples
\item Multiplexer
\item Bundles
\item Ports
\item Modules
\item Chisel Background and some Scala (constructor code...)
\item Testing 1
\item If/else, case statements
\item Functions
\item Function examples for combinational circuits (e.g. ALU)
\item Functions with state (rising edge, counter,...)
\item FSM
\item Wave form debugging
\item printf debugging
\item Memories
\item Modules and structure
\item Bulk connections
\item Scala for circuit creation (``scripting'' hardware generation)
\end{itemize}
\end{frame}

\begin{frame}[fragile]{Functions}
\begin{itemize}
\item Section 6, but that might come later
\item xxx
\item xxx
\end{itemize}
\begin{chisel}
code
\end{chisel}
\end{frame}

\begin{frame}[fragile]{Title}
\begin{itemize}
\item xxx
\item xxx
\item xxx
\end{itemize}
\begin{chisel}
code
\end{chisel}
\end{frame}

\begin{frame}[fragile]{Title}
\begin{itemize}
\item xxx
\item xxx
\item xxx
\end{itemize}
\begin{chisel}
code
\end{chisel}
\end{frame}

\begin{frame}[fragile]{Chisel Tutorial from UCB}
\begin{itemize}
\item Collection of small exercises
\item Only in simulation, no hardware required (+/-)
\item All examples in \emph{one} design
\begin{itemize}
\item Results in a little bit more complex setup
\end{itemize}
\item Needs a Internet connection
\begin{itemize}
\item  Tests against latest Chisel version
\end{itemize}
\item
\item
\item
\end{itemize}
\end{frame}

\begin{frame}[fragile]{Chisel Tutorial}
\begin{itemize}
\item Get the tutorial
\end{itemize}
\begin{chisel}
git clone https://github.com/ucb-bar/chisel-tutorial.git
cd chisel-tutorial
\end{chisel}
\begin{itemize}
\item Test the installation with a Hello World
\end{itemize}
\begin{chisel}
cd hello
make
\end{chisel}
\begin{itemize}
\item May take some time
\end{itemize}
\end{frame}

\begin{frame}[fragile]{Very Minimal Hello World}
\begin{chisel}
class Hello extends Module {
  val io = new Bundle { 
    val out = UInt(OUTPUT, 8)
  }
  io.out := UInt(42)
}
\end{chisel}
\begin{itemize}
\item Produces hardware for a single constant
\end{itemize}
\end{frame}

\begin{frame}[fragile]{Testing the Minimal Hello World}
\begin{chisel}
class HelloTests(c: Hello) extends Tester(c) {
  step(1)
  expect(c.io.out, 42)
}
\end{chisel}
\begin{itemize}
\item Drive the simulation with \code{step(1)}, which is a single clock tick
\item Test output against expected value
\end{itemize}
\end{frame}

\begin{frame}[fragile]{Tutorial Problems}
\begin{chisel}
cd problems
make Mux2.out
\end{chisel}
\begin{itemize}
\item This example should already work
\item Read the hardware and test code
\end{itemize}
\end{frame}

\begin{frame}[fragile]{Tutorial Problems}
\begin{chisel}
make Mux4.out
\end{chisel}
\begin{itemize}
\item Keep sbt running
\item Fix the Mux4 component so that the tests complete
\end{itemize}
\end{frame}

%%%%%%%%%%%%%%%%
\begin{frame}[fragile]{Title}
\begin{chisel}
code
\end{chisel}
\begin{itemize}
\item xxx
\item xxx
\item xxx
\end{itemize}
\end{frame}

\begin{frame}[fragile]{Title}
\begin{itemize}
\item xxx
\item xxx
\item xxx
\item xxx
\item xxx
\end{itemize}
\end{frame}
%%%%%%%%%%%%%%%%

\begin{frame}[fragile]{From here on Slides that shall be moved somewhere}
\end{frame}

\begin{frame}[fragile]{More Chisel Example Code}
\begin{itemize}
\item The time-predictable processor Patmos
\item An SRAM controller for the DE2-115 board
\item An SSRAM controller
\item An UART
\item A memory arbiter
\item Caches
\item ...
\item \url{https://github.com/t-crest/patmos}
\end{itemize}
\end{frame}


\begin{frame}[fragile]{More Chisel Documentation}
\begin{itemize}
\item Started a textbook on ``Digital Design with Chisel''
\item Considered a work-in-progress (V 0.01 ;-)
\item \url{https://github.com/schoeberl/chisel-book}
\item Feedback is welcome
\item Contains all the slides
\end{itemize}
\end{frame}

\end{document}